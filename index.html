<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advisory Builder</title>
  <style>
    :root {
      color-scheme: light;
      font-family: "SFMono-Regular", Menlo, Consolas, "Liberation Mono", monospace;
      background-color: #f8fafc;
      color: #0f172a;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 2rem 1.5rem;
    }

    .page {
      width: min(1100px, 100%);
      display: grid;
      gap: 1.5rem;
    }

    header {
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: clamp(1.75rem, 4vw, 2.5rem);
      letter-spacing: 0.04em;
    }

    p.lead {
      margin: 0.35rem 0 0;
      color: #475569;
    }

    .panes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1rem;
    }

    .card {
      background: white;
      border-radius: 14px;
      padding: 1rem;
      box-shadow: 0 12px 35px rgba(15, 23, 42, 0.12);
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    label {
      font-weight: 700;
      color: #1e293b;
      letter-spacing: 0.01em;
    }

    .tabs {
      display: inline-flex;
      background: #e2e8f0;
      border-radius: 12px;
      padding: 0.25rem;
      gap: 0.25rem;
      margin: 0.5rem auto 0;
    }

    .tab {
      border: none;
      background: transparent;
      padding: 0.6rem 1rem;
      border-radius: 10px;
      font-weight: 700;
      color: #1e293b;
      cursor: pointer;
      transition: background 150ms ease, color 150ms ease, box-shadow 150ms ease;
      font-family: inherit;
    }

    .tab:focus-visible {
      outline: 3px solid rgba(37, 99, 235, 0.4);
      outline-offset: 2px;
    }

    .tab.active {
      background: #0ea5e9;
      color: white;
      box-shadow: 0 6px 18px rgba(14, 165, 233, 0.35);
    }

    textarea {
      width: 100%;
      min-height: 320px;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      padding: 0.75rem;
      font-size: 1rem;
      line-height: 1.6;
      resize: vertical;
      font-family: inherit;
      background: #f8fafc;
      color: #0f172a;
      transition: border-color 150ms ease, box-shadow 150ms ease;
    }

    textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.16);
      background: white;
    }

    .preview {
      min-height: 320px;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
      padding: 0.75rem;
      background: #f8fafc;
      overflow: auto;
      line-height: 1.7;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: inherit;
    }

    .placeholder {
      color: #94a3b8;
    }

    .tip {
      background: #e0f2fe;
      color: #075985;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      border: 1px solid #bae6fd;
      font-size: 0.95rem;
    }

    .ground-stop-form {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      font-family: inherit;
      font-size: 1rem;
    }

    .line {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      align-items: baseline;
    }

    .inline-input {
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      padding: 0.3rem 0.45rem;
      background: #f8fafc;
      font-family: inherit;
      font-size: 1rem;
      min-width: 120px;
      color: #0f172a;
    }

    .inline-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.18);
      background: white;
    }

    .spacer {
      height: 0.6rem;
    }
  </style>
</head>
<body>
  <main class="page">
    <header>
      <h1>Advisory Builder</h1>
      <p class="lead">Populate the editable fields to assemble your advisory preview.</p>
      <div class="tabs" role="tablist" aria-label="Advisory types">
        <button class="tab active" role="tab" aria-selected="true" aria-controls="panel-ground-stop" data-type="Ground Stop" id="tab-ground-stop">Ground Stop</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="panel-ground-delay" data-type="Ground Delay Program" id="tab-ground-delay">Ground Delay Program</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="panel-reroute" data-type="Reroute" id="tab-reroute">Reroute</button>
      </div>
    </header>

    <div class="panes" id="panels">
      <section class="card">
        <label for="source">Inputs</label>
        <div id="input-container"></div>
        <div class="tip">
          Tip: Text outside of the fields is fixed; type into the boxed fields to update the preview.
        </div>
      </section>

      <section class="card">
        <label for="preview">Formatted output</label>
        <div id="preview" class="preview placeholder" aria-live="polite">
          Your formatted text will appear here.
        </div>
      </section>
    </div>
  </main>

  <script>
    const preview = document.getElementById("preview");
    const tabs = Array.from(document.querySelectorAll(".tab"));
    const inputContainer = document.getElementById("input-container");

    const groundStopFields = {
      headerAdvisoryNumber: "",
      headerAirportFacility: "",
      headerDateGroup: "",
      ctlElement: "",
      adlTime: "",
      groundStopPeriodStart: "",
      groundStopPeriodEnd: "",
      cumulativeProgramPeriodStart: "",
      cumulativeProgramPeriodEnd: "",
      flightInclusions: "",
      departureFacilitiesIncluded: "",
      currentDelays: "",
      previousDelays: "",
      newDelays: "",
      probabilityOfExtension: "",
      impactingCondition: "",
      specificCondition: "",
      comments: "",
      advisoryValidStart: "",
      advisoryValidEnd: "",
      advisorySignature: "",
    };

    const groundStopStructure = [
      [
        { text: "vATCSCC ADVZY " },
        { field: "headerAdvisoryNumber", placeholder: "Header Advisory Number" },
        { text: " " },
        { field: "headerAirportFacility", placeholder: "Header Airport/Facility" },
        { text: " " },
        { field: "headerDateGroup", placeholder: "Header Date Group" },
        { text: " CDM GROUND STOP" },
      ],
      [{ text: "CTL ELEMENT: " }, { field: "ctlElement", placeholder: "CTL Element" }],
      [{ text: "ELEMENT TYPE: APT" }],
      [{ text: "ADL TIME: " }, { field: "adlTime", placeholder: "ADL Time" }],
      [
        { text: "GROUND STOP PERIOD: " },
        { field: "groundStopPeriodStart", placeholder: "Ground Stop Period Start" },
        { text: " - " },
        { field: "groundStopPeriodEnd", placeholder: "Ground Stop Period End" },
      ],
      [
        { text: "CUMULATIVE PROGRAM PERIOD: " },
        { field: "cumulativeProgramPeriodStart", placeholder: "Cumulative Program Period Start" },
        { text: " - " },
        { field: "cumulativeProgramPeriodEnd", placeholder: "Cumulative Program Period End" },
      ],
      [{ text: "FLT INCL: " }, { field: "flightInclusions", placeholder: "Flight Inclusions" }],
      [
        { text: "DEP FACILITIES INCLUDED: " },
        { field: "departureFacilitiesIncluded", placeholder: "Departure Facilities Included" },
      ],
      [
        { text: "CURRENT TOTAL, MAXIMUM, AVERAGE DELAYS: " },
        { field: "currentDelays", placeholder: "Current Delays" },
      ],
      [
        { text: "PREVIOUS TOTAL, MAXIMUM, AVERAGE DELAYS: " },
        { field: "previousDelays", placeholder: "Previous Delays" },
      ],
      [
        { text: "NEW TOTAL, MAXIMUM, AVERAGE DELAYS: " },
        { field: "newDelays", placeholder: "New Delays" },
      ],
      [
        { text: "PROBABILITY OF EXTENSION: " },
        { field: "probabilityOfExtension", placeholder: "Probability of Extension" },
      ],
      [
        { text: "IMPACTING CONDITION: " },
        { field: "impactingCondition", placeholder: "Impacting Condition" },
        { text: " / " },
        { field: "specificCondition", placeholder: "Specific Condition" },
      ],
      [{ text: "COMMENTS: " }, { field: "comments", placeholder: "Comments" }],
      [{ spacer: true }],
      [
        { field: "advisoryValidStart", placeholder: "Advisory Valid Start" },
        { text: "-" },
        { field: "advisoryValidEnd", placeholder: "Advisory Valid End" },
      ],
      [{ field: "advisorySignature", placeholder: "Advisory Signature" }],
    ];

    const contentByType = {
      "Ground Stop": { mode: "template", values: { ...groundStopFields } },
      "Ground Delay Program": { mode: "text", text: "" },
      Reroute: { mode: "text", text: "" },
    };

    let currentType = "Ground Stop";
    let activeTextarea = null;

    function createInput(partKey, placeholder) {
      const input = document.createElement("input");
      input.type = "text";
      input.className = "inline-input";
      input.placeholder = placeholder;
      input.setAttribute("aria-label", placeholder);
      input.spellcheck = false;
      input.value = contentByType["Ground Stop"].values[partKey] || "";
      input.dataset.field = partKey;
      input.addEventListener("input", (event) => {
        contentByType["Ground Stop"].values[partKey] = event.target.value;
        updatePreview();
      });
      return input;
    }

    function renderGroundStop() {
      inputContainer.innerHTML = "";
      activeTextarea = null;
      const form = document.createElement("div");
      form.className = "ground-stop-form";

      groundStopStructure.forEach((parts) => {
        if (parts.some((part) => part.spacer)) {
          const spacer = document.createElement("div");
          spacer.className = "spacer";
          form.appendChild(spacer);
          return;
        }

        const line = document.createElement("div");
        line.className = "line";

        parts.forEach((part) => {
          if (part.text) {
            const span = document.createElement("span");
            span.textContent = part.text;
            line.appendChild(span);
          }

          if (part.field) {
            const input = createInput(part.field, part.placeholder);
            line.appendChild(input);
          }
        });

        form.appendChild(line);
      });

      inputContainer.appendChild(form);
      const firstInput = form.querySelector("input");
      if (firstInput) {
        firstInput.focus();
      }
    }

    function renderTextArea(type) {
      inputContainer.innerHTML = "";
      const textarea = document.createElement("textarea");
      textarea.id = "source";
      textarea.placeholder = "Start typing...";
      textarea.value = contentByType[type].text;
      textarea.addEventListener("input", () => {
        contentByType[type].text = textarea.value;
        updatePreview();
      });
      inputContainer.appendChild(textarea);
      activeTextarea = textarea;
      textarea.focus();
    }

    function buildGroundStopPreview() {
      const values = contentByType["Ground Stop"].values;
      return groundStopStructure
        .map((parts) => {
          if (parts.some((part) => part.spacer)) {
            return "";
          }

          return parts
            .map((part) => {
              if (part.text) return part.text;
              if (part.field) {
                const fieldValue = values[part.field]?.trim();
                return fieldValue ? fieldValue : part.placeholder;
              }
              return "";
            })
            .join("");
        })
        .join("\n");
    }

    function escapeHTML(value) {
      return value
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function formatText(rawValue) {
      const escaped = escapeHTML(rawValue);
      const bolded = escaped.replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>");
      const italicized = bolded.replace(/_(.+?)_/g, "<em>$1</em>");
      const paragraphs = italicized
        .split(/\n{2,}/)
        .map((block) => block.replace(/\n/g, "<br>"))
        .map((block) => `<p>${block}</p>`)
        .join("");

      return paragraphs;
    }

    function updatePreview() {
      if (currentType === "Ground Stop") {
        const assembled = buildGroundStopPreview();
        if (!assembled.trim()) {
          preview.textContent = "Your formatted text will appear here.";
          preview.classList.add("placeholder");
          return;
        }

        preview.classList.remove("placeholder");
        preview.textContent = assembled;
        return;
      }

      if (!activeTextarea) return;
      const value = activeTextarea.value.trim();
      if (!value) {
        preview.innerHTML = "Your formatted text will appear here.";
        preview.classList.add("placeholder");
        return;
      }

      preview.classList.remove("placeholder");
      preview.innerHTML = formatText(activeTextarea.value);
    }

    function switchTab(newType) {
      if (newType === currentType) return;
      currentType = newType;

      tabs.forEach((tab) => {
        const isActive = tab.dataset.type === newType;
        tab.classList.toggle("active", isActive);
        tab.setAttribute("aria-selected", String(isActive));
        tab.tabIndex = isActive ? 0 : -1;
      });

      if (newType === "Ground Stop") {
        renderGroundStop();
      } else {
        renderTextArea(newType);
      }

      updatePreview();
    }

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => switchTab(tab.dataset.type));
      tab.addEventListener("keydown", (event) => {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          switchTab(tab.dataset.type);
        }
      });
    });

    renderGroundStop();
    updatePreview();
  </script>
</body>
</html>
